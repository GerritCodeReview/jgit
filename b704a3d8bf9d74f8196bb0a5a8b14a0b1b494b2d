{
  "comments": [
    {
      "key": {
        "uuid": "AABOGH///iE\u003d",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/transport/AdvertiseRefsHookChain.java",
        "patchSetId": 4
      },
      "lineNbr": 53,
      "author": {
        "id": 1
      },
      "writtenOn": "2012-03-01T01:38:08Z",
      "side": 1,
      "message": "Ouch. This sucks.\n\nConsider we write a hook that wants to only show refs/heads/ and refs/tags/. Lets also consider it may want to support being mixed in with other hooks in a chain.\n\nIf there was a hook before it, it should use getAdvertisedRefs() to look at the current map, pick out only refs/{heads,tags} and then reset the map. OK but this is really slow if there was no prior hook because you are now doing getAllRefs() to pre-populate the transport object. That defeats one of the notions of this hook, which is to try and use the lower-level APIs to only scan the subspaces that it needs.\n\nRight now as you have it there is no clean way to know if there is a prior hook and whether you should be replacing the prior results, filtering them, etc.",
      "revId": "b704a3d8bf9d74f8196bb0a5a8b14a0b1b494b2d",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AABOGH///h4\u003d",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/transport/AdvertiseRefsHookChain.java",
        "patchSetId": 4
      },
      "lineNbr": 53,
      "author": {
        "id": 383
      },
      "writtenOn": "2012-03-01T01:41:14Z",
      "side": 1,
      "message": "Would it be sufficient for this case to change the definition of getAdvertisedRefs() to not call db.getAllRefs()? That is, it will only return non-null if a previous hook has called setAdvertisedRefs(). The latter hook would have to have separate code paths for the filtering/scanning cases, but I don\u0027t see a way around that.",
      "parentUuid": "AABOGH///iE\u003d",
      "revId": "b704a3d8bf9d74f8196bb0a5a8b14a0b1b494b2d",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AABOGH///hg\u003d",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/transport/AdvertiseRefsHookChain.java",
        "patchSetId": 4
      },
      "lineNbr": 53,
      "author": {
        "id": 1
      },
      "writtenOn": "2012-03-01T01:43:53Z",
      "side": 1,
      "message": "Yes it would help if we change getAdvertisedRefs() to return null until a hook has called setAdvertisedRefs(). You may need to audit the callers within JGit to make sure they are OK with this ordering of operations. I suspect its OK... but WTF do I know.",
      "parentUuid": "AABOGH///h4\u003d",
      "revId": "b704a3d8bf9d74f8196bb0a5a8b14a0b1b494b2d",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AABOGH///hY\u003d",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/transport/AdvertiseRefsHookChain.java",
        "patchSetId": 4
      },
      "lineNbr": 53,
      "author": {
        "id": 383
      },
      "writtenOn": "2012-03-01T01:46:28Z",
      "side": 1,
      "message": "Ok, will do. I\u0027ve audited the callers in the past, I don\u0027t mind doing it again.\n\nUnder this new contract we would of course not require hooks to call setAdvertisedRefs(), going back to the discussion in the previous patch.",
      "parentUuid": "AABOGH///hg\u003d",
      "revId": "b704a3d8bf9d74f8196bb0a5a8b14a0b1b494b2d",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    }
  ]
}