{
  "comments": [
    {
      "key": {
        "uuid": "87e453f8_e7e17bbb",
        "filename": "org.eclipse.jgit.test/tst/org/eclipse/jgit/lib/RepositoryCacheTest.java",
        "patchSetId": 2
      },
      "lineNbr": 232,
      "author": {
        "id": 9
      },
      "writtenOn": "2016-06-08T11:50:28Z",
      "side": 1,
      "message": "The test code looks mostly OK. For my understanding: could it happen that cache.clearAllExpired() gets called from the WorkQueue just before this assert? It seems unlikely that this will happen as the initial delay is set to 10 seconds and this test will very likely finish much faster.\n\nHowever, if the RepositoryCache class gets loaded before this test runs (from another test), it will initialize its static members including the RepositoryCache.cache and the constructor will schedule the cleanup task at 10/10 seconds rate. If this happens 10 seconds before this test is executed the cleanup task could interfere with this test. Right?",
      "revId": "26eb23eb3f3e25dc63ee871237ef3f95c6b84f7e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "87e453f8_67ec8b88",
        "filename": "org.eclipse.jgit.test/tst/org/eclipse/jgit/lib/RepositoryCacheTest.java",
        "patchSetId": 2
      },
      "lineNbr": 232,
      "author": {
        "id": 6590
      },
      "writtenOn": "2016-06-08T12:09:05Z",
      "side": 1,
      "message": "Good point! The only way I can think to avoid the issue you mention would be to reconfigure RepositoryCache at the beginning of the test. Reconfiguring it with a clean up delay that is long enough to make sure clearAllExpired() doesn\u0027t get called by the clean up task.\n\nIn order to do so, we need to squash this change and the follow up one into Christian\u0027s change.",
      "parentUuid": "87e453f8_e7e17bbb",
      "revId": "26eb23eb3f3e25dc63ee871237ef3f95c6b84f7e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "87e453f8_02457519",
        "filename": "org.eclipse.jgit.test/tst/org/eclipse/jgit/lib/RepositoryCacheTest.java",
        "patchSetId": 2
      },
      "lineNbr": 232,
      "author": {
        "id": 9
      },
      "writtenOn": "2016-06-08T15:06:24Z",
      "side": 1,
      "message": "I have been squashing the changes and will push soon.\n\nWe could also enhance the configuration of the RepositoryCache.reconfigure so that it doesn\u0027t schedule the cleanup task when the RepositoryCacheConfig.delay \u003d\u003d 0. This feature would also provide a compatibility with the old behavior, repository GC-ed when JVM decides to do it.",
      "parentUuid": "87e453f8_67ec8b88",
      "revId": "26eb23eb3f3e25dc63ee871237ef3f95c6b84f7e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "87e453f8_e229693c",
        "filename": "org.eclipse.jgit.test/tst/org/eclipse/jgit/lib/RepositoryCacheTest.java",
        "patchSetId": 2
      },
      "lineNbr": 232,
      "author": {
        "id": 6590
      },
      "writtenOn": "2016-06-08T15:19:30Z",
      "side": 1,
      "message": "I think RepositoryCacheConfig.delay \u003d\u003d 0 should be the default to preserve backward compatibility.",
      "parentUuid": "87e453f8_02457519",
      "revId": "26eb23eb3f3e25dc63ee871237ef3f95c6b84f7e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    }
  ]
}