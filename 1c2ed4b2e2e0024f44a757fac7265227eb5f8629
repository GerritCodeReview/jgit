{
  "comments": [
    {
      "key": {
        "uuid": "e7f622df_c39862d5",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/storage/file/FileBasedConfig.java",
        "patchSetId": 2
      },
      "lineNbr": 173,
      "author": {
        "id": 440
      },
      "writtenOn": "2018-12-11T20:01:48Z",
      "side": 1,
      "message": "I had done some experiments in this area in this change: https://git.eclipse.org/r/#/c/126730/2/org.eclipse.jgit/src/org/eclipse/jgit/storage/file/FileBasedConfig.java\n\nMy finding was that a \"locked by other process\" issue would be signaled by a FileNotFoundException. And in that case this code still throws the noFile exception and does not continue with the while loop, right? Or do I read the control flow wrong?\n\nAt least that is how I remember why I had explicitly taken out the rethrowing in my experimental change linked above. I had forcefully locked the file from outside while debugging, and without my change there was no re-trying.",
      "range": {
        "startLine": 170,
        "startChar": 0,
        "endLine": 173,
        "endChar": 7
      },
      "revId": "1c2ed4b2e2e0024f44a757fac7265227eb5f8629",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "24b73810_3300c789",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/storage/file/FileBasedConfig.java",
        "patchSetId": 2
      },
      "lineNbr": 173,
      "author": {
        "id": 44628
      },
      "writtenOn": "2018-12-11T20:10:21Z",
      "side": 1,
      "message": "\u003e My finding was that a \"locked by other process\" issue would be\n \u003e signaled by a FileNotFoundException. And in that case this code\n \u003e still throws the noFile exception and does not continue with the\n \u003e while loop, right? Or do I read the control flow wrong?\n\nThat\u0027s quite right. However, all those FileNotFoundException we get look like \"the other process\" is Eclipse itself! So our threads stomp on each others feet. That alone would be handled by a synchronized block around reading the file.\n\nThe LockFile should handle multiple processes. So if we get a FileNotFoundException here while the file actually exists something is definitely wrong, like \"No permission\".\n\nExcept that the lockAndWait doesn\u0027t really work; a simple Thread.sleep() is probably not a good idea there. The build failed because it forks several tests that do not mock the user config, so they all failed because of contention on the real Jenkins user\u0027s .gitconfig!",
      "parentUuid": "e7f622df_c39862d5",
      "range": {
        "startLine": 170,
        "startChar": 0,
        "endLine": 173,
        "endChar": 7
      },
      "revId": "1c2ed4b2e2e0024f44a757fac7265227eb5f8629",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1d49f6cc_d5bf0385",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/storage/file/FileBasedConfig.java",
        "patchSetId": 2
      },
      "lineNbr": 173,
      "author": {
        "id": 440
      },
      "writtenOn": "2018-12-11T20:20:58Z",
      "side": 1,
      "message": "\u003e So if we get a\n \u003e FileNotFoundException here while the file actually exists something\n \u003e is definitely wrong, like \"No permission\".\n\nNo, sorry. We are on Windows in this scenario. A typical cause is a virus scanner, which will just deny access to the file as long as it has not scanned the content itself after the last change to the file. So the inaccessibility is really for a short time only, not permanent. That is why we need to retry.",
      "parentUuid": "24b73810_3300c789",
      "range": {
        "startLine": 170,
        "startChar": 0,
        "endLine": 173,
        "endChar": 7
      },
      "revId": "1c2ed4b2e2e0024f44a757fac7265227eb5f8629",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9c440e4c_40d55da2",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/storage/file/FileBasedConfig.java",
        "patchSetId": 2
      },
      "lineNbr": 173,
      "author": {
        "id": 44628
      },
      "writtenOn": "2018-12-11T20:39:53Z",
      "side": 1,
      "message": "If you think it\u0027s a virus scanner, then let\u0027s not bother with mutual exclusion at all -- it won\u0027t help.\n\nIf you add a short sleep() before the retries in your attempt, we could use that, and I\u0027d abandon this one.\n\nIf we then still get bug reports about such exceptions, we can try this locking idea again.",
      "parentUuid": "1d49f6cc_d5bf0385",
      "range": {
        "startLine": 170,
        "startChar": 0,
        "endLine": 173,
        "endChar": 7
      },
      "revId": "1c2ed4b2e2e0024f44a757fac7265227eb5f8629",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    }
  ]
}