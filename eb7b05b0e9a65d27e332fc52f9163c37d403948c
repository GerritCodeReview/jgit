{
  "comments": [
    {
      "key": {
        "uuid": "07b223f6_cd563f32",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 329,
      "author": {
        "id": 6590
      },
      "writtenOn": "2016-10-12T11:27:09Z",
      "side": 1,
      "message": "Now that we no longer leak usage count on purpose and the usage count is now ignored anyway, I think we can get rid of this.",
      "range": {
        "startLine": 329,
        "startChar": 2,
        "endLine": 329,
        "endChar": 43
      },
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_4d9cef76",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 329,
      "author": {
        "id": 4
      },
      "writtenOn": "2016-10-12T11:42:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "07b223f6_cd563f32",
      "range": {
        "startLine": 329,
        "startChar": 2,
        "endLine": 329,
        "endChar": 43
      },
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_ed24e3b8",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 329,
      "author": {
        "id": 95
      },
      "writtenOn": "2016-10-12T11:56:36Z",
      "side": 1,
      "message": "Could you explain a bit more detailled what\u0027s the purpose of this loop? \n\nMaybe I miss the bigger context: I haven\u0027t got the whole idea of how the cache intends to care about Repository refcount. Is it explained somewhere?",
      "parentUuid": "07b223f6_cd563f32",
      "range": {
        "startLine": 329,
        "startChar": 2,
        "endLine": 329,
        "endChar": 43
      },
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_0dee77af",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 329,
      "author": {
        "id": 6590
      },
      "writtenOn": "2016-10-12T12:19:01Z",
      "side": 1,
      "message": "I will try to make a long story short. Before the time based eviction mechanism, the cache used to leak one usage count on purpose to prevent repositories from being evicted from the cache and rely on soft reference and JVM gc to evict repositories when running out of memory.\n\nThis loop was closing repositories twice to bring back usage count to 0 and evict all repositories. This was not even working because it was only evicting unused repositories or repositories used by only one thread. All the repositories concurrently used by more than one thread were not cleared because usage count was greater than 2.\n\nThere are many changes to understand the transition from the usage counter leak to the time based eviction:\n\nhttps://git.eclipse.org/r/#/c/55898/\nhttps://git.eclipse.org/r/#/c/55902/\nhttps://git.eclipse.org/r/#/c/56281/\nhttps://git.eclipse.org/r/#/c/74903/\nhttps://git.eclipse.org/r/#/c/74904/\nhttps://git.eclipse.org/r/#/c/81563/",
      "parentUuid": "07b223f6_ed24e3b8",
      "range": {
        "startLine": 329,
        "startChar": 2,
        "endLine": 329,
        "endChar": 43
      },
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_8d45271c",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 329,
      "author": {
        "id": 4
      },
      "writtenOn": "2016-10-12T12:35:08Z",
      "side": 1,
      "message": "This loop predates the move of JGit to Eclipse so we have to dig in the old repository for explanations. This loop was introduced with the change introducing the RepositoryCache [1]. Though this commit doesn\u0027t explain why this loop is needed, I guess it was used to workaround the refcount problems in Repository which were fixed recently. I\u0027ll add Shawn as a reviewer, he wrote that code, maybe he can remember.\n\n[1] http://repo.or.cz/jgit/spearce.git/commit/02cca37fc880b86313345ebbabda43f0f93e32c9",
      "parentUuid": "07b223f6_ed24e3b8",
      "range": {
        "startLine": 329,
        "startChar": 2,
        "endLine": 329,
        "endChar": 43
      },
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_3861bc05",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 333,
      "author": {
        "id": 95
      },
      "writtenOn": "2016-10-11T13:54:58Z",
      "side": 1,
      "message": "Is it intended that the repository is closed independent of the current refcount? Then this looks good to me.",
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_b3840faf",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 333,
      "author": {
        "id": 4
      },
      "writtenOn": "2016-10-11T19:08:19Z",
      "side": 1,
      "message": "yes, this I intended",
      "parentUuid": "07b223f6_3861bc05",
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_0d1cb76f",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 333,
      "author": {
        "id": 95
      },
      "writtenOn": "2016-10-12T11:56:36Z",
      "side": 1,
      "message": "unregister() still removes the repository from the cache without closing it. Should behave differently then clear()?",
      "parentUuid": "07b223f6_b3840faf",
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "07b223f6_6de293c0",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/lib/RepositoryCache.java",
        "patchSetId": 2
      },
      "lineNbr": 333,
      "author": {
        "id": 6590
      },
      "writtenOn": "2016-10-12T12:19:01Z",
      "side": 1,
      "message": "Unregister allows users of the cache to unregister a repository without closing it.",
      "parentUuid": "07b223f6_0d1cb76f",
      "revId": "eb7b05b0e9a65d27e332fc52f9163c37d403948c",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    }
  ]
}