{
  "comments": [
    {
      "key": {
        "uuid": "c3397dab_d996fa80",
        "filename": "org.eclipse.jgit.ssh.apache.test/tst/org/eclipse/jgit/transport/sshd/NoFilesSshTest.java",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 1684
      },
      "writtenOn": "2020-06-04T09:44:05Z",
      "side": 1,
      "message": "Config is still written here? Also where/how the HostKeyVerifier is disabled in memory only setting? I\u0027m tried to switch to in memory only set up for gerrit, but is still running into this exception:\n\n  org.eclipse.jgit.errors.TransportException: ssh://user@127.0.0.1:33211: Server key did not validate\n  at org.eclipse.jgit.transport.sshd.SshdSessionFactory.getSession(SshdSessionFactory.java:233)\n\nThe whole stack trace is here: [1].\n\n* [1] http://paste.openstack.org/show/794353/",
      "range": {
        "startLine": 141,
        "startChar": 1,
        "endLine": 151,
        "endChar": 2
      },
      "revId": "5a5d85a4a3407df5f9693ab36287e72726c512f6",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "12547090_1a60f4c8",
        "filename": "org.eclipse.jgit.ssh.apache.test/tst/org/eclipse/jgit/transport/sshd/NoFilesSshTest.java",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 44628
      },
      "writtenOn": "2020-06-04T10:02:06Z",
      "side": 1,
      "message": "\u003e Config is still written here?\n\nYes, but see comment in line 155: if this config were taken into account the test would fail. Config file is switched off completely in line 57 above. Writing the config here is part of the test setup.\n\n \u003e where/how the HostKeyVerifier is disabled\n\nIn this test it isn\u0027t. The test installs its own ServerKeyDatabase (see line 63ff), so the built-in OpenSshServerKeyDAtabase will not be used. This own ServerKeyDatabase contains only exactly one host key (the testServerKey, line 69), and accepts only this testServerKey (line 77). It also never uses the CredentialProvider to ask what to do about unknown/expired/changed keys; it just rejects those.\n\nIf you wanted a ServerKeyDatabase that accepted any key, you\u0027d install something like\n\n  return new ServerKeyDatabase() {\n  \n    @Override\n    public List\u003cPublicKey\u003e lookup(String connectAddress,\n      InetSocketAddress remoteAddress,\n      Configuration config) {\n      return Collections.emptyList();\n    }\n  \n    @Override\n    public boolean accept(String connectAddress,\n      InetSocketAddress remoteAddress,\n      PublicKey serverKey, Configuration config,\n      CredentialsProvider provider) {\n      return true;\n    }\n  \n  };\n\nlookup() is used only in JGitClientSession.resolveAvailableSignaturesProposal() to get all already known host keys for a server to be able to put these key types at the front of the proposal to tell the server to give the client an already known host key in preference over some other one that the server might also have, but that might still be unknown on the client.",
      "parentUuid": "c3397dab_d996fa80",
      "range": {
        "startLine": 141,
        "startChar": 1,
        "endLine": 151,
        "endChar": 2
      },
      "revId": "5a5d85a4a3407df5f9693ab36287e72726c512f6",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "906b9f8f_504c4c02",
        "filename": "org.eclipse.jgit.ssh.apache.test/tst/org/eclipse/jgit/transport/sshd/NoFilesSshTest.java",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 1684
      },
      "writtenOn": "2020-06-04T10:41:43Z",
      "side": 1,
      "message": "Thanks for claryfing. I think it would be a significant simplification for the in memory only setup: easier waqy to programmatically disable the HostKeyVerifier feature, so that the caller could user the recently added builder method: [1] with one liner:\n\n  builder.setServerKeyDatabase(new DisableHostKeyVerifier())\n\nor similar.\n\n* [1] https://git.eclipse.org/r/#/c/161448/4/org.eclipse.jgit.ssh.apache/src/org/eclipse/jgit/transport/sshd/SshdSessionFactoryBuilder.java@22",
      "parentUuid": "12547090_1a60f4c8",
      "range": {
        "startLine": 141,
        "startChar": 1,
        "endLine": 151,
        "endChar": 2
      },
      "revId": "5a5d85a4a3407df5f9693ab36287e72726c512f6",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e15bec2f_e85ebb4c",
        "filename": "org.eclipse.jgit.ssh.apache.test/tst/org/eclipse/jgit/transport/sshd/NoFilesSshTest.java",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 44628
      },
      "writtenOn": "2020-06-04T10:57:23Z",
      "side": 1,
      "message": "Clients that don\u0027t want to verify the server host key at all are probably only occurring in test setups. Not sure it\u0027s worth adding a default implementation for this. The main intent of ServerKeyDatabase was to accommodate some users who don\u0027t use known_hosts files but their own database back-end to manage host keys. See bug 547619.\n\nClients who really want to completely switch off host key verification can surely write that little no-op implementation of the ServerKeyDatabase interface themselves. For most clients doing so is probably not a good idea.\n\nAn alternative to installing a no-op ServerKeyDatabase might also be to set a ConfigStoreFactory providing an in-memory SshConfigStore that had the \"StrictHostKeyChecking no\" setting.",
      "parentUuid": "906b9f8f_504c4c02",
      "range": {
        "startLine": 141,
        "startChar": 1,
        "endLine": 151,
        "endChar": 2
      },
      "revId": "5a5d85a4a3407df5f9693ab36287e72726c512f6",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9b008ee6_8353b188",
        "filename": "org.eclipse.jgit.ssh.apache.test/tst/org/eclipse/jgit/transport/sshd/NoFilesSshTest.java",
        "patchSetId": 3
      },
      "lineNbr": 151,
      "author": {
        "id": 1684
      },
      "writtenOn": "2020-06-04T11:39:40Z",
      "side": 1,
      "message": "\u003e An alternative to installing a no-op ServerKeyDatabase might also\n \u003e be to set a ConfigStoreFactory providing an in-memory\n \u003e SshConfigStore that had the \"StrictHostKeyChecking no\" setting.\n\n+1. This would be useful addition. I have just answered your question on the corresponding gerrit change: [1].\n\n[1] https://gerrit-review.googlesource.com/c/gerrit/+/270112",
      "parentUuid": "e15bec2f_e85ebb4c",
      "range": {
        "startLine": 141,
        "startChar": 1,
        "endLine": 151,
        "endChar": 2
      },
      "revId": "5a5d85a4a3407df5f9693ab36287e72726c512f6",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    }
  ]
}