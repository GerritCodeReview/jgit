{
  "comments": [
    {
      "key": {
        "uuid": "a7979753_e1b7c53e",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/GC.java",
        "patchSetId": 2
      },
      "lineNbr": 971,
      "author": {
        "id": 5
      },
      "writtenOn": "2017-11-13T09:05:52Z",
      "side": 1,
      "message": "We could delete files here which we haven\u0027t created. A different process which is doing gc with jgit could own these files. Don\u0027t we know the temporary files we created and delete only them?",
      "revId": "999139d0dc263541737ba0e0c9dc43fe9d9d1e1e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a7979753_9c2ae6b3",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/GC.java",
        "patchSetId": 2
      },
      "lineNbr": 971,
      "author": {
        "id": 24046
      },
      "writtenOn": "2017-11-13T10:26:26Z",
      "side": 1,
      "message": "Good point. I see two options here: one, we keep a track of the files this run of GC created in order to only delete those. The problem I see is if this run of GC is cancelled and this method is not run, the temporal files will stay there. Second option could be to limit the delete operation to files older than a certain time; this will avoid deleting temporal files of a concurrent JGit GC process while avoiding cancelled runs to keep accumulating these files. \nAnother (better) option?",
      "parentUuid": "a7979753_e1b7c53e",
      "revId": "999139d0dc263541737ba0e0c9dc43fe9d9d1e1e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a7979753_7c9ffab0",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/GC.java",
        "patchSetId": 2
      },
      "lineNbr": 971,
      "author": {
        "id": 5
      },
      "writtenOn": "2017-11-13T14:03:29Z",
      "side": 1,
      "message": "I like the idea of a grace period for unknown tmp files. We could do both. Delete directly the files which we know we have created. And delete the remaining files only when they are older than a certain period.",
      "parentUuid": "a7979753_9c2ae6b3",
      "revId": "999139d0dc263541737ba0e0c9dc43fe9d9d1e1e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a7979753_abccb7e0",
        "filename": "org.eclipse.jgit/src/org/eclipse/jgit/internal/storage/file/GC.java",
        "patchSetId": 2
      },
      "lineNbr": 971,
      "author": {
        "id": 24046
      },
      "writtenOn": "2017-11-14T13:00:26Z",
      "side": 1,
      "message": "I decided to go with the second option only given the removal of these temporary files is done in a finally block (lines 1227-1234). That means, unless the JVM is killed, they should be cleaned up as part of the regular GC workflow and this is what we see most of the time. This change should cover, then, the case when that finally block is not executed.\n\nIn order to avoid interfering with a concurrent GC operation, as you appropriately pointed out, only temporary files 24 hours or older are deleted. Given the GC operation takes max 2-3 hours in our biggest repositories, this threshold should be safe enough.",
      "parentUuid": "a7979753_7c9ffab0",
      "revId": "999139d0dc263541737ba0e0c9dc43fe9d9d1e1e",
      "serverId": "97ee7c02-f12f-4043-b43e-dea463d88b31",
      "unresolved": false
    }
  ]
}